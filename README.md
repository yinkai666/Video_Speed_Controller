# 视频倍速播放增强版 (Enhanced Video Speed Controller)

一个强大而简单的视频倍速控制脚本，支持大多数网页视频播放器（可通过修改脚本的 @match 规则扩展支持的网站），特别优化了YouTube和Bilibili等主流视频网站。 修改自苗言的脚本https://greasyfork.org/zh-CN/scripts/523429-%E8%A7%86%E9%A2%91%E5%80%8D%E9%80%9F%E6%92%AD%E6%94%BE

本项目由个人维护。如果你觉得脚本对你有帮助，欢迎扫码打赏支持，捐赠将帮助我持续维护和更新项目。感谢你的支持！

<img src="https://my-qr-codes.pages.dev/qr.jpg" alt="收款二维码" width="400">

## 主要功能

### 基础倍速控制
- `→` 长按：以预设倍速播放（可在菜单中设置，范围 0.1-16，默认2.5倍速）
- `→` 松开：恢复原始播放速度
- `→` 单击：快进5秒
- `←` 单击：快退5秒
- `Space` 空格键：暂停/播放视频

### 倍速调节
- `+` / `-` ：调整**下次长按** `→` 时的目标倍速值（步长可在菜单中设置，范围 0.1-16，默认0.5）
- `]` / `[` ：增加/减少**当前**播放速度（步长可在菜单中设置，范围 0.1-3，默认0.5，最低 0.1x）
- `P` ：立即恢复为默认播放速度

### 逐帧播放 (视频暂停时)
- `,` : 上一帧 (按 1/30 秒步长后退)
- `.` : 下一帧 (按 1/30 秒步长前进)

### 音量控制
- `↑` ：增加音量（每次+10%）
- `↓` ：减小音量（每次-10%）

### 全屏控制
- `Enter` ：切换全屏/退出全屏

### 多视频控制
- 页面中有多个视频时，每个视频左上角会显示控制按钮（如“视频1”、“视频2”等按钮）
- 点击按钮可切换控制目标视频
- 当前控制的视频按钮会高亮显示

### 网站启用与高级兼容性

#### 标准启用流程
1.  在任何未默认支持的网站上，通过油猴菜单点击 **“在当前网站启用视频倍速控制”**。
2.  脚本会提示您刷新页面。
3.  **刷新页面**后，脚本将在该网站上激活。

#### **重要：如何处理 `iframe` 或检测失败的视频**
在某些情况下（尤其是视频被 `<iframe>` 框架嵌入时），即使您启用了脚本并刷新，快捷键可能依然无效。

**解决方案：使用“重新扫描”功能**

1.  确保您已经按照“标准启用流程”**启用并刷新**了页面。
2.  在当前页面上，再次打开油猴菜单，点击新增的 **“重新扫描以查找视频”** 命令。
3.  脚本会立即进行一次深度扫描，这通常能找到并控制隐藏在 `iframe` 或其他复杂结构中的视频。

#### 管理已启用网站
- **查看**: 通过油猴菜单中的 **“查看所有临时启用的网站”**，可以在浏览器控制台 (F12) 中看到你手动添加的所有网站列表。
- **禁用**: 在一个已启用的网站上，油猴菜单中会自动出现 **“从临时启用列表中移除当前网站”** 的选项，方便你随时禁用。所有设置相关的命令（如“设置默认播放速度”）也只会在网站启用后出现。

## 特色优势
1. 无需界面操作，纯键盘控制
2. 支持绝大多数网页视频播放器
3. 特别优化了YouTube和Bilibili的兼容性
4. 实时显示速度、音量和全屏状态变化提示
5. 完美支持动态加载的视频页面
6. 优化的按键响应，提高与浏览器手势的兼容性

## 使用说明
1. 安装脚本后即可使用，无需额外设置
2. 在任何包含HTML5视频的网页中都可以使用
3. 特别适合观看教学视频、演讲等需要经常调整播放速度的场景
4. 所有操作都会有浮动提示，方便了解当前状态

## 兼容性
- 支持所有主流浏览器
- 支持大多数使用HTML5播放器的视频网站
- 特别优化支持：
  - YouTube
  - Bilibili
  - 其他使用标准HTML5 video标签的网站

## 更新日志

### v1.4.0 (重大重构)
- **代码重构**: 对脚本核心代码进行了全面重构，提升了代码质量、可读性和可维护性。
- **性能优化**:
  - 合并并优化了 `MutationObserver`，显著降低了在动态页面上的性能开销。
  - 为视频检测引入了防抖（Debounce）机制，避免了不必要的重复计算。
- **兼容性增强**:
  - **重构启用流程**: 移除了令人困惑的“手动查找视频”功能。
  - **新增“重新扫描”功能**: 在网站启用后，提供“重新扫描以查找视频”的菜单命令，专门用于解决 `iframe` 或动态加载视频的兼容性问题，操作流程更符合逻辑。
- **安全加固**: 替换了 `innerHTML` 的使用，杜绝了潜在的 XSS 风险。
- **逻辑增强**: 增加了对动态移除视频的“垃圾回收”机制，防止内存泄漏。
- **体验优化**: 移除了所有阻塞性的 `alert` 弹窗，改用更友好的浮动通知。

### v1.3.6
- 修复 YouTube 页面在视频区域外点击（如作者简介）导致快捷键失效的问题。

### v1.3.5
- 修复部分情况下过早按下快捷键会将播放速度恢复到1倍速


### v1.3.4
- 移除 哔哩哔哩在某些情况可能出现的多视频控制按键

### v1.3.3
- 移除 未找到视频元素时的冗余提示信息

### v1.3.2
- 修复 逐帧播放功能：修复了暂停状态下 `,` 和 `.` 键失效的问题

### v1.3.1
- 新增 空格键暂停/播放功能：按空格键可以暂停或播放视频
- 优化 通用网站兼容性

### v1.3.0
- 新增 暂停状态下按左右方向键功能：在视频暂停时按左右方向键会取消暂停并执行相应操作

### v1.2.9
- fix bugs

### v1.2.8
- 新增 临时启用网站功能：可通过油猴菜单在任意网站上临时启用脚本
- 新增 多视频控制功能：在页面有多个视频时，可通过点击选择控制哪一个视频
- 优化 通用网站兼容性：添加通配符匹配规则，支持所有网站

### v1.2.7
- 优化 B站和YouTube的全屏功能，使回车键触发的全屏与网站原生全屏按钮效果一致
- 改进全屏按钮选择器，提高兼容性

### v1.2.6
- 修复 Bilibili 评论区快捷键冲突问题
- 优化 Shadow DOM 中的输入元素检测逻辑

### v1.2.5
- 新增 逐帧播放功能：视频暂停时，按 `,` 上一帧，按 `.` 下一帧 (默认步长 1/30s)。
- 新增 自定义调速步长：可在油猴菜单中设置按 `[` / `]` 调整当前速度的步长 (范围 0.1-3)。
- 新增 自定义目标倍速调整步长：可在油猴菜单中设置按 `+` / `-` 调整目标倍速的步长 (范围 0.1-16)。
- 调整 速度下限：所有速度调整的最低值改为 0.1x。
- 调整 设置范围：默认播放速度和目标倍速的设置范围改为 0.1-16。

### v1.2.1
- 优化 YouTube 按键处理逻辑
- 降低事件拦截权限，提高与浏览器手势的兼容性
- 改进视频播放器区域检测

### v1.2.0
- 新增 YouTube 左方向键快退5秒功能
- 优化 YouTube 按键响应

### v1.1.0
- 新增音量控制功能（上下方向键）
- 新增全屏切换功能（回车键）
- 优化提示信息显示

### v1.0.0
- 首次发布
- 实现基础倍速控制功能
- 添加 YouTube 和 Bilibili 特别支持
